# Проектная работа "Веб-ларек"
https://github.com/Woohda/web-larek-frontend

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Интерфейс для данных карточки продукта

```
export interface IProduct {
    id: string
    title: string
    price: number
    description: string
    category: string
    image: string
}
```

Интерфейс для данных пользователя

```
export interface IUserData {
    payment: string
    address: string
    email: string
    phone: string
}
```

Интерфейс для модели данных карточек продукта

```
export interface IAppData {
	catalog: IProduct[];
	preview: string | null;
}
```

Интерфес для данных главной страницы

```
export interface IPage {
    counter: number;
    catalog: HTMLElement[];
    preview: string | null;
    locked: boolean;
}
```

Интерфес для данных корзины

```
export interface IBasket {
    items: HTMLElement[];
    seletedItems: string[];
    total: number;  
}
```

Интерфейс для данных заказа

```
export interface IOrder extends IUserData {
    total: number
    items: string[]
}
```

Интерфес для данных заказа для передачи на сервер

```
export interface IOrderResult { 
    id: string
    total: string
}
```
Интерфес для данных Api

```
export interface IApi {
    baseUrl: string;
    cdn: string;
    get<T>(uri: string): Promise<T>;
    post<T>(uri: string, data: object, method?: ApiPostMethods): Promise<T>;
}
```
Тип данных, ошибок совершенных в формах оформления заказа
```
export type FormErrors = Partial<Record<keyof IOrder, string>>;

```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс AppData
Класс отвечает за хранение и логику работы с данными каталога карточек продукта, корзиной и оформления товара.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- basket: IProduct[] = [] - массив выбранных товаров в корзине;
- catalog: IProduct[] - массив товаров в каталоге;
- preview: string | null - id выбранного товара для просмотра в модальном окне;
- order - объек данных для оформления заказа;	
- formErrors: FormErrors = {} - объект с данными ошибок валидации форм.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setCatalog — формирует массив товаров в каталоге, генерирует событие изменения каталога;
- setPreview — передает id выбранного товара для предварительного просмотра в модальном окне;
- addToBasket - добавляет выбранный товар в массив товаров в корзине; 
- removeFromBasket — удаляет товар из массива товаров в корзине;
- setTotal - метод для подсчета итоговой суммы заказа.
- clearBasket — удаляет все товары из корзины после оформления заказа;
- checkItem - проверяет наличие товара в корзине;
- createOrder - создания объекта заказа для отправки на сервер;
- setOrderField - устанавливает значения полей в объекте заказа и проверяет валидность формы оформления покупки;
- validateForm - валидирует поля ввода данных форм оформления заказа.

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента. 
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _content: HTMLElement - элемент модального окна;
- events: IEvents - брокер событий.

#### Класс Form
Реализует модальное окно с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
- constructor(protected container: HTMLFormElement, protected events: IEvents) —  конструктор принимает `HTML`-элемент формы и экземпляр класса `EventEmitter` для возможности инициации событий и обработки действий пользователя;\
Поля класса:
- _submit: HTMLButtonElement - Кнопка подтверждения;
- _error: HTMLElement - элемент отображения информации о невалидности поля.

Методы:
- onInputChange — обрабатывает изменение значения в полях ввода форм;
- valid — устанавливает состояние на кнопку, с учетом валидности формы;
- errors — выводит сообщение об ошибке;
- render — отображает форму с передачей данных о состоянии и ошибках, если они есть.

#### Класс Product
Отвечает за отображение карточки, задавая в карточке данные названия, описания, изображения, категории и цены товара. Класс используется для отображения карточек на главной странице сайта и для просмотра в модальном окне. В конструктор класса передается `HTML`-элемент, что позволяет при необходимости формировать карточки разных вариантов верстки и принимает экземпляр `EventEmitter` для инициации событий.\
Поля класса: 
- _indexItem - идентификатор товара в корзине;
- _category - элемент для категории товара;
- _title - элемент для названия товара;
- _price - элемент для цены товара;
- _description - элемент для описания товара;
- _image - элемент для изображения товара;
- _button - элемент кнопки для добавления товара в корзину.
Методы:
- set - устанавливает значение свойств товара;
- get - получает значение свойств товара;
- categoryColor - добаляет класс `HTML`-элементу категории для отрисовки цветового оформления соответсвующего макету.

#### Класс Page
Отвечает за отображение главной страницы сайта. Класс используется для отображения каталога, корзины, счетчика товаров в корзине на главной странице сайта согласно макета, а также указывает состояние блокировки станицы при открытии модального окна. В конструктор класса передается `HTML`-элемент и экземпляр `EventEmitter` для инициации событий.\
- _counter - элемент для счетчика товаров в корзине;
- _catalog - элемент для размещения каталога товаров;
- _wrapper - элемент для обертки страницы;
- _basket - элемент для корзины.

Методы:
- set - устанавливает значение свойств.

#### Класс Basket
Отвечает за отображение окна корзины. Класс используется для отображения товара с названием и ценой, удаления товаров из корзины, итоговой суммы и кнопки для оформления заказа. В конструктор класса передается `HTML`-элемент и экземпляр `EventEmitter` для инициации событий.\
- _productList - элемент для списка добавленных товаров в корзину;
- _total - элемент для итоговой суммы заказа;
- _button - элемент кнопки для оформления заказа.

Методы:
- set - устанавливает значения добавленных товаров и итоговой суммы заказа;

#### Класс Order
Отвечает за отображение окна оформления заказа. Класс используется для отображения кнопки выбора способы оплаты и поля ввода адреса доставки. В конструктор класса передается `HTML`-элемент и экземпляр `EventEmitter` для инициации событий.\
- _paymentButton - элемент кнопки выбора способа оплаты;

Методы:
- set - устанавливает значение адреса из поля ввода;
- selected- метод для отображения валидности кнопки.

#### Класс Contacts
Отвечает за отображение окна оформления заказа. Класс используется для отображения полей ввода контактных данных. В конструктор класса передается `HTML`-элемент и экземпляр `EventEmitter` для инициации событий.\
- _paymentButton - элемент кнопки выбора способа оплаты;

Методы:
- set - устанавливает значение номера телефона и почты из полей ввода;

#### Класс Success
Отвечает за отображение окна успешного оформления заказа. Класс используется для отображения итоговой суммы заказа и кнопки возвращения к покупкам. В конструктор класса передается `HTML`-элемент и экземпляр `EventEmitter` для инициации событий.\
- _total - элемент для итоговой суммы заказа;
- _close - элемент кнопки для возвращения к покупкам.

Методы:
- set - устанавливает значение итоговой суммы заказа.

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `catalog:changed` - изменение массива товаров;
- `preview:changed`- изменение товара открываемого в модальном окне;
- `item:check` - проверка наличия товара в корзине;



*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:select` - выбор карточки товара для отображения в модальном окне;
- `modal:open` - открытие модального окна;
- `modal:close` - закрытие модального окна;
- `basket:open` - открытие модального окна корзины;
- `item:add` - добавление товара в корзину;
- `item:remove` - удаление товара из корзины;
- `basket:changed`- изменение массива товаров добавленных в корзину;
- `count:changed` - изменение счетчика количества добавленных в корзину товаров;
- `order:ready` - изменение состояния кнопки оформления заказа;
- `order:open` - открытие модального окна оформления заказа;
- `payment:select` - событие выбора способа оплаты;
- `order:changet` - событие, изменения полей ввода адреса и способа оплаты;
- `contacts:changet` - событие, изменения полей ввода почты и номера телефона;
- `formErrors:change` - событие, измениия состояния ошибок валидации;
- `order:submit` - сохранение данных пользователя в модальном окне
- `contacts:submit` - сохранение данных пользователя в модальном окне и оформления заказа.





